import React, { lazy } from 'react';
import { Link, Typography } from '@mui/material';
import { getEnv, getSession, SimpleFeature, } from '@jbrowse/core/util';
import { BaseCard } from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail';
// lazies
const BreakendOptionDialog = lazy(() => import('./BreakendOptionDialog'));
function LocStringList({ locStrings, model, }) {
    const session = getSession(model);
    return (React.createElement("div", null,
        React.createElement(Typography, null, "Link to linear view of breakend endpoints"),
        React.createElement("ul", null, locStrings.map((locString, index) => (React.createElement("li", { key: `${locString}-${index}` },
            React.createElement(Link, { href: "#", onClick: event => {
                    var _a;
                    event.preventDefault();
                    const { view } = model;
                    try {
                        if (view) {
                            (_a = view.navToLocString) === null || _a === void 0 ? void 0 : _a.call(view, locString);
                        }
                        else {
                            throw new Error('No view associated with this feature detail panel anymore');
                        }
                    }
                    catch (e) {
                        console.error(e);
                        session.notify(`${e}`);
                    }
                } }, `LGV - ${locString}`)))))));
}
function LaunchBreakpointSplitViewPanel({ locStrings, model, feature, viewType, }) {
    const session = getSession(model);
    const simpleFeature = new SimpleFeature(feature);
    return (React.createElement("div", null,
        React.createElement(Typography, null, "Launch split views with breakend source and target"),
        React.createElement("ul", null, locStrings.map(locString => (React.createElement("li", { key: `${JSON.stringify(locString)}` },
            React.createElement(Link, { href: "#", onClick: event => {
                    event.preventDefault();
                    session.queueDialog(handleClose => [
                        BreakendOptionDialog,
                        { handleClose, model, feature: simpleFeature, viewType },
                    ]);
                } }, `${feature.refName}:${feature.start} // ${locString} (split view)`)))))));
}
export default function BreakendPanel(props) {
    const { model, locStrings, feature } = props;
    const session = getSession(model);
    const { pluginManager } = getEnv(session);
    let viewType;
    try {
        viewType = pluginManager.getViewType('BreakpointSplitView');
    }
    catch (e) {
        // ignore
    }
    return (React.createElement(BaseCard, { ...props, title: "Breakends" },
        React.createElement(LocStringList, { model: model, locStrings: locStrings }),
        viewType ? (React.createElement(LaunchBreakpointSplitViewPanel, { viewType: viewType, model: model, locStrings: locStrings, feature: feature })) : null));
}
